# AstrBot 睡眠插件 (astrbot_plugin_sleep)

## 插件描述

`astrbot_plugin_sleep` 是一款为 AstrBot 框架开发的插件，它允许您的机器人在可配置的时间段内模拟“睡眠”状态。当插件在某个聊天会话中被激活，并且当前时间处于该会话设定的睡眠周期内时，插件会修改发送给大语言模型 (LLM) 的系统提示词。这将引导 LLM 以符合睡眠中角色的方式进行回应，例如使用第三人称描述或以角色身份对“互动”作出反应。

本插件支持会话隔离配置，这意味着每个用户或群聊的睡眠设置（启用/禁用状态、睡眠时间）都可以是不同的。这些设置会被持久化存储。

## 功能特性

* **基于时间的睡眠模式：** 在指定的时间段内激活特殊的 LLM 行为。
* **可定制的睡眠人格：** LLM 会被提示扮演一个正在睡觉的角色，并包含具体的行为指导（例如，描述睡眠状态、对打扰做出反应）。提示词中使用的角色名称是可配置的。
* **会话隔离控制：**
    * 为每个聊天会话独立启用或禁用睡眠功能。
    * 为每个聊天会话设置自定义的睡眠开始和结束时间。
* **管理员专属配置命令：** 设置睡眠时间的命令 (`/设置睡眠时间`) 仅限 AstrBot 管理员使用。
* **持久化会话设置：** 每个会话的配置（启用状态、自定义睡眠时段）都会被保存，并在 AstrBot 重启或插件重载后依然生效。
* **全局插件配置：**
    * 睡眠人格的默认角色名称。
    * 新会话的默认睡眠开始和结束时间。
    * 这些全局默认设置可以通过 AstrBot 管理面板进行配置 (基于 `_conf_schema.json` 文件)。

## 安装指南

1.  **下载/复制插件：**
    将整个 `astrbot_plugin_sleep` 文件夹（包含 `main.py`, `_conf_schema.json`, `requirements.txt` 和此 `README.md` 文件）放入您的 AstrBot 项目的 `data/plugins/` 目录下。
    目录结构应如下所示：
    ```
    AstrBot/
    └── data/
        └── plugins/
            └── astrbot_plugin_sleep/
                ├── main.py
                ├── _conf_schema.json
                ├── requirements.txt
                └── README.md
    ```

2.  **重载 AstrBot：**
    重启您的 AstrBot 实例，或通过 AstrBot 网页用户界面 (WebUI) 重载插件，以使更改生效。

## 配置说明

### 全局插件配置 (通过管理面板)

安装插件后，您可以通过 AstrBot 管理面板配置此插件的全局默认设置：

1.  在 AstrBot WebUI 中导航至插件管理部分。
2.  找到 `astrbot_plugin_sleep` 插件，并点击“管理”。
3.  您将能够设置以下值 (这些值定义在 `_conf_schema.json` 文件中):
    * **`character_name` (角色名称)**：机器人在睡眠模式下使用的默认角色名 (例如："我", "小爱", "助手A")。默认值："我"。
    * **`default_sleep_start_hour` (默认睡眠开始小时)**：对于那些启用了睡眠功能但未设置特定时间的会话，睡眠模式开始的默认小时 (0-23)。默认值：0 (即 00:00)。
    * **`default_sleep_end_hour` (默认睡眠结束小时)**：睡眠模式结束的默认小时 (0-23)。如果小于开始小时，则表示为次日。默认值：6 (即 06:00)。

这些全局设置将作为新会话启用睡眠功能时，或会话未自定义其特定设置时的默认值。

### 会话特定配置 (通过命令)

用户可以使用下述命令为其特定的聊天会话配置睡眠设置。这些会话设置会覆盖该会话的全局默认值，并且是持久化的。

## 命令列表

以下命令可用于管理聊天会话中睡眠插件的行为：

* **`/开启睡眠`**
    * **描述：** 为当前聊天会话启用睡眠功能。启用后，如果当前时间处于本会话配置的睡眠时段内，机器人将进入睡眠模式。
    * **用法：** `/开启睡眠`

* **`/关闭睡眠`**
    * **描述：** 为当前聊天会话禁用睡眠功能。无论当前时间如何，机器人将恢复正常行为。
    * **用法：** `/关闭睡眠`

* **`/设置睡眠时间 HH-HH`**
    * **描述：** (仅限管理员) 为当前聊天会话设置自定义的睡眠时段。小时数应使用24小时制 (0-23)。
    * **示例：**
        * `/设置睡眠时间 0-6` (设置睡眠时间为 00:00 至 06:00)
        * `/设置睡眠时间 22-5` (设置睡眠时间为 22:00 至次日 05:00)
    * **权限：** 只有拥有 AstrBot 管理员权限的用户才能使用此命令。

* **`/查询睡眠时间`**
    * **描述：** 显示当前聊天会话的睡眠功能状态 (开启/关闭) 以及配置的睡眠时段。
    * **用法：** `/查询睡眠时间`

## 睡眠模式行为

当某个会话的睡眠模式被激活，并且当前时间处于其睡眠时段内时，插件会向 LLM 的系统提示词中添加以下指令：