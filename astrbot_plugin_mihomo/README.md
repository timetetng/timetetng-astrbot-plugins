# 🚀 AstrBot Plugin Mihomo

Astrbot `mihomo` 内核管理插件。支持节点查看、测速、切换，并独创了**自定义节点组**和**全自动优选**功能，确保你的网络时刻保持最佳状态。

## ✨ 功能特性

  * **节点管理**：查看节点列表、延迟，并快速切换。
  * **批量测速**：对指定关键词或分组的节点进行批量延迟测试。
  * **自定义分组**：通过关键词将节点归类（例如：建一个 "HK" 组包含所有香港节点）。
  * **自动优选 (Auto)**：后台驻留任务，定期监测指定组的节点，自动切换到延迟最低的节点。

## ⚙️ 配置说明

在 AstrBot 的插件配置中（或配置文件中）填入以下信息：

| 配置项 | 默认值 | 说明 |
| :--- | :--- | :--- |
| `api_url` | `http://127.0.0.1:9090` | Mihomo API 地址 |
| `api_secret` | `""` (空) | 如果设置了 secret，请在此处填写 |

## 📝 指令列表

所有指令前缀为 `/mihomo`。

### 1\. 基础控制

  * **查看节点列表**

    ```
    /mihomo group [关键词]
    ```

    列出当前策略组下的节点。如果提供了关键词，则仅显示匹配的节点。

      * *示例*：`/mihomo group` (看全部) / `/mihomo group 香港` (只看香港)

  * **切换节点**

    ```
    /mihomo use <序号>
    ```

    配合 `group` 指令使用。输入列表中的序号即可切换。

  * **节点测速**

    ```
    /mihomo speed [关键词/组名]
    ```

    对匹配的节点进行即时测速，并显示 Top 10 最快节点。

### 2\. 📂 自定义组 (Custom Group)

将包含特定关键词的节点保存为一个“组”，方便后续批量管理或用于自动优选。

  * **创建/添加组**

    ```
    /mihomo cgroup create <组名> <关键词>
    /mihomo cgroup add <组名> <关键词>
    ```

      * *示例*：`/mihomo cgroup create MyGame 日本` (把所有含“日本”的节点加入 MyGame 组)

  * **删除组**

    ```
    /mihomo cgroup del <组名>
    ```

  * **查看所有组**

    ```
    /mihomo cgroup list
    ```

### 3\. 🤖 自动优选 (Auto Task)

后台自动监控指定“组”或“关键词”的节点，当当前节点变慢或有更好节点时自动切换。

  * **开启自动优选**

    ```
    /mihomo auto start <组名/关键词>
    ```

      * *示例*：`/mihomo auto start MyGame` (每5分钟检测一次 MyGame 组，自动切到最快的)

  * **停止自动优选**

    ```
    /mihomo auto stop <组名/关键词>
    ```

  * **查看运行中的任务**

    ```
    /mihomo auto list
    ```

-----

## 💡 使用场景示例

1.  **日常切换**：
    发送 `/mihomo group` 查看当前节点，发送 `/mihomo use 3` 切换到第3个。
2.  **游戏/低延迟需求**：
    先创建一个包含低延迟节点的组：`/mihomo cgroup create LowPing 专线`。
    然后开启自动优选：`/mihomo auto start LowPing`。
    插件会自动帮你维持在延迟最低的“专线”节点上。


